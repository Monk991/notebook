## [Axios](https://www.axios-http.cn/docs/intro)

### 安装

```bash
PS C:\Users\Monk\Documents\reborn\blog\workspace\blog-frontend> yarn add axios
yarn add v1.22.19
warning package-lock.json found. Your project contains lock files generated by tools other than Yarn. It is advised not to mix package managers in order to avoid resolution inconsistencies caused by unsynchronized lock files. To clear this warning, remove package-lock.json.
[1/4] Resolving packages...
[2/4] Fetching packages...
[3/4] Linking dependencies...
[4/4] Building fresh packages...

success Saved lockfile.
success Saved 9 new dependencies.
info Direct dependencies
└─ axios@1.5.0
info All dependencies
├─ asynckit@0.4.0
├─ axios@1.5.0
├─ combined-stream@1.0.8
├─ delayed-stream@1.0.0
├─ follow-redirects@1.15.2
├─ form-data@4.0.0
├─ mime-db@1.52.0
├─ mime-types@2.1.35
└─ proxy-from-env@1.1.0
Done in 6.26s.
```

### /src/utils/http.ts

```ts
import axios from 'axios'

const AXIOS_BASE_URL = '/mgr'

const $http = axios.create({
  baseURL: AXIOS_BASE_URL,
  timeout: 2500
})

$http.interceptors.request.use((config) => {
  // 设置请求头
  config.headers = config.headers || {}
  let token = localStorage.getItem('token')
  console.info('token', token)
  if (token) {
    config.headers['X-Token'] = token
  }
  return config
})

$http.interceptors.response.use(
  (response) => {
    return Promise.resolve(response.data)
  },
  (error) => {
    ElMessage.error(error.message)
    return Promise.reject({
      code: error.response ? error.response.status : error.code,
      data: error.message
    })
  }
)

export default $http
```

- /src/apis/sys/user.ts

```ts
import $http from '../../utils/http'

export const listUser = () => $http.get('/user/list')
```

### [配置开发代理](https://cn.vitejs.dev/config/server-options.html)

- /vite.config.ts

```ts
// ...
export default defineConfig({
  // ...
  server: {
    proxy: {
      '/mgr': {
        target: 'http://127.0.0.1:4523/m1/2005653-0-default',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/mgr/, '')
      }
    }
  }
})
```

### 验证

- /src/views/sys/user/index.vue

```vue
<script setup lang="ts">
import { listUser } from '../../../apis/sys/user'
import { onMounted } from 'vue'

function loadList() {
  listUser().then((resp) => {
    console.info(resp)
  })
}

onMounted(() => {
  localStorage.setItem('token', '123')
  loadList()
})
</script>
```
